{% extends "stash_base.html" %}

{% block title %}Stash{% endblock %}

{% block stash_active %}active{% endblock %}
{% block upload_active %}{% endblock %}

{% block content %}
	<div id="content-target">
	{% partialdef content-partial inline %}
		<div class="btn-toolbar mb-3">
			{% load url_utils %}
			<div class="btn-group me-3">
				<button class="btn btn-secondary {% if filters.nsfw == "sfw" %}active{% endif %}"
				        hx-get="{% get_filter_url nsfw="sfw" %}" hx-target="#content-target">SFW</button>
				<button class="btn btn-secondary {% if filters.nsfw == "both" %}active{% endif %}"
				        hx-get="{% get_filter_url nsfw="both" %}" hx-target="#content-target">Both</button>
				<button class="btn btn-danger {% if filters.nsfw == "nsfw" %}active{% endif %}"
				        hx-get="{% get_filter_url nsfw="nsfw" %}" hx-target="#content-target">NSFW</button>
			</div>

			<div class="input-group mb-3 custom-sort-group">
				<button class="btn btn-secondary" data-bs-toggle="dropdown" aria-expanded="false">
					Date
				</button>
				<ul class="dropdown-menu">
					<li><a class="dropdown-item {% if filters.sort == "created" %}active{% endif %}"
						     hx-get="{% get_filter_url sort="created" %}" hx-target="#content-target">Created</a></li>
					<li><a class="dropdown-item {% if filters.sort == "modified" %}active{% endif %}"
						     hx-get="{% get_filter_url sort="modified" %}" hx-target="#content-target">Modified</a></li>
				</ul>
				<button class="btn btn-secondary" data-bs-toggle="tooltip" data-bs-placement="top"
				        data-bs-title="{% if filters.direction == "desc" %}Descending{% else %}Ascending{% endif %}"
				        hx-get="{% get_filter_url "dir" %}" hx-target="#content-target">
					<i class="fas fa-caret-{% if filters.direction == "desc" %}down{% else %}up{% endif %}"></i>
				</button>
			</div>
		</div>

		{% for file in object_list %}
			<div class="card mb-2 {% if file.nsfw %}border-danger{% else %}border-secondary{% endif %} overflow-hidden">
				<div class="row g-0 h-100" style="min-height: 150px">
					<div class="col-10 d-flex text-decoration-none text-reset">
						<a href="view/{{ file.id }}" class="action-button-cell">
							<div class="thumbnail-container d-flex align-items-center justify-content-center">
								{% load thumbnail %}
								{% if file.file_type == "image" or file.file_type == "video" %}
									<img src="{% thumbnail file.file 'preview' %}" class="img-fluid">
								{% elif file.file_type == "audio" %}
									<i class="fas fa-music fa-4x"></i>
								{% elif file.file_type == "other" %}
									<i class="fas fa-file fa-4x"></i>
								{% endif %}
							</div>
							<div class="card-body flex-grow-1">
								<div class="row">
									<div class="col-8">
										<h5 class="card-title">{{ file }}</h5>
										<p class="card-text text-muted small">{{ file.description }}</p>
									</div>
									<div class="col-4 text-end">
									{% if file.nsfw %}
										<span class="badge bg-danger">NSFW</span>
									{% endif %}
									</div>
								</div>
							</div>
						</a>
					</div>
					<div class="col-2 border-start d-flex flex-column">
						<a href="{{ file.file.url }}" download class="border-bottom action-button-cell">
							<i class="fas fa-download fa-lg"></i>
						</a>
						<button onclick="copyLink('{{ file.link }}')" class="btn action-button-cell">
							<i class="fas fa-link fa-lg"></i>
						</button>
					</div>
				</div>
			</div>
	{% empty %}
		<p>No files yet.</p>
	{% endfor %}
	{% endpartialdef %}
	</div>

	<script>
		function enableTooltips() {
			tooltipTriggerList = document.querySelectorAll("[data-bs-toggle='tooltip']");
			[...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
		}

		enableTooltips() //Enable tooltips on page load

		document.body.addEventListener("htmx:afterSwap", () => {
			const oldTooltips = document.querySelectorAll(".tooltip");
			oldTooltips.forEach(t => t.remove());

			enableTooltips()
		});

		function copyLink(link) {
			navigator.clipboard.writeText(link);
			alert("Copied: " + link)
		}
	</script>
{% endblock %}